<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta charset="UTF-8">
<style>
canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
}
</style>
</head>
<body onload="startGame()">
<script>
    var player;
    var walls = [];
    //for logging what keys are pressed
    var keys = [];
    var background1;

    function startGame() {
        race.start();
        player = new turtle(100, 300);
        // wall1 = new wall(200,50, 500, 20);
        // wall2 = new wall(200,50, 1000, 200);
        // walls.push(wall1);
        // walls.push(wall2);
        background1 = new background(50);
    }

    function updateGame() {
        race.clear();
        
        background1.move();
        background1.update();

        player.speedX = 0;
        player.speedY = 0;
        if (keys[37]) {
            player.speedX = -3; 
        }
        if (keys[39]) {
            player.speedX = 3; 
        }
        if (keys[38]) {
            player.speedY = -3; 
        }
        if (keys[40]) {
            player.speedY = 3; 
        }
        player.move();
        player.update();

        for (var i=0; i < walls.length; i++) {
            walls[i].update();
        }
    }

    var race  = {
        canvas: document.createElement("canvas"),
        start: function() {
            this.canvas.width = 800;
            this.canvas.height = 600;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = setInterval(updateGame, 20);
            // window.addEventListener('mouseup', function (e) {
            //     pool.x = e.pageX;
            //     pool.y = e.pageY;
            //     clickAction();
            // })
            // window.addEventListener('touchstart', function (e) {
            //     pool.x = e.pageX;
            //     pool.y = e.pageY;
            // })
            // window.addEventListener('touchend', function (e) {
            //     pool.x = false;
            //     pool.y = false;
            // })
            window.addEventListener('keydown', function (e) {
                keys[e.keyCode] = true;
            })
            window.addEventListener('keyup', function (e) {
                keys[e.keyCode] = false;
            })
        },
        clear : function(){
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        }
    }

    function background(stripes) {
        this.X = 0;
        this.speed = 1;
        this.numberOfStripes = stripes;
        
        this.update = function() {
            ctx = race.context;
            
            var color1 = "#F2EEB3"; //light
            var color2="#CCC897"; //dark
            for (var i=0;i<this.numberOfStripes*3;i++){
                var thickness = race.canvas.width / this.numberOfStripes;
                ctx.beginPath();
                ctx.strokeStyle = i % 2?color1:color2;
                ctx.lineWidth =thickness;
                ctx.lineCap = 'round';
                
                ctx.moveTo(i*thickness + thickness/2 - race.canvas.width + this.X,0);
                ctx.lineTo(this.X + i*thickness+thickness/2,race.canvas.width);
                ctx.stroke();
                ctx.closePath();
            }
           
        }
        this.move = function () {
            this.X -= this.speed;
            if (this.X <= (-1* this.numberOfStripes*3)) {
                this.X = 0;
            }
        }
    }


    function turtle(x, y) {
        this.X = x;
        this.Y = y;
        this.speedX = 0;
        this.speedY = 0;
        this.frameSpeed = 15;
        this.currentFrame = 0;
        this.isJumping = false;
        var step1 = new Image();
        var step2 = new Image();
        var idle = new Image();
        step1.src = "./assets/images/turtleL2.png";
        step2.src = "./assets/images/turtleL3.png";
        idle.src = "./assets/images/turtleL.png";
        this.update = function() {
            ctx = race.context;
            if (this.currentFrame >= this.frameSpeed) {
                ctx.drawImage(step1, this.X, this.Y);
                if (this.currentFrame >= (2*this.frameSpeed)) {
                    this.currentFrame = 0;
                }
            } else {
                ctx.drawImage(step2, this.X, this.Y);
            }
            this.currentFrame += 1;
        }
        this.move = function() {
            this.X += this.speedX;
            this.Y += this.speedY;
        }
    }

    function wall(w, h, x, y) {
        this.width = w;
        this.height = h;
        this.X = x;
        this.Y = y;
        this.speed = 1;
        this.update = function() {
            ctx = race.context;
            ctx.beginPath();
            ctx.rect(this.X, this.Y, this.width, this.height);
            ctx.stroke();
            this.move();
            ctx.closePath();
        }

        this.move = function() {
            this.X -= this.speed;
        }
    }

</script>
</body>
</html>