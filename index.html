<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta charset="UTF-8">
<style>
canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
    margin: auto;
    display: block;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
}
</style>
</head>
<body onload="startGame()">
<script>
    var player;
    var walls = [];
    //for logging what keys are pressed
    var keys = [];
    var lineCount = 50;
    var lines = [];

    function startGame() {
        race.start();
        player = new turtle(100, 300);
        twit1 = new twitter(200,50);
        twit2 = new twitter(100, 200);
        walls.push(twit1);
        walls.push(twit2);

        for (var i =0; i < lineCount; i++) {
            lines.push(new backLine());
        }
        
    }

    function updateGame() {
        race.clear();
        
        for(var i = 0; i < lines.length; i++) {
            lines[i].update();
            lines[i].move();
        }

        player.speedX = 0;
        player.speedY = 0;
        if (keys[37]) {
            player.speedX = -3; 
        }
        if (keys[39]) {
            player.speedX = 3; 
        }
        if (keys[38]) {
            player.speedY = -3; 
        }
        if (keys[40]) {
            player.speedY = 3; 
        }
        player.move();
        player.update();

        for (var i=0; i < walls.length; i++) {
            walls[i].update();
        }
    }

    var race  = {
        canvas: document.createElement("canvas"),
        start: function() {
            this.canvas.width = 600;
            this.canvas.height = 800;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = setInterval(updateGame, 20);
            // window.addEventListener('mouseup', function (e) {
            //     pool.x = e.pageX;
            //     pool.y = e.pageY;
            //     clickAction();
            // })
            // window.addEventListener('touchstart', function (e) {
            //     pool.x = e.pageX;
            //     pool.y = e.pageY;
            // })
            // window.addEventListener('touchend', function (e) {
            //     pool.x = false;
            //     pool.y = false;
            // })
            window.addEventListener('keydown', function (e) {
                keys[e.keyCode] = true;
            })
            window.addEventListener('keyup', function (e) {
                keys[e.keyCode] = false;
            })
        },
        clear: function(){
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        }
    }

    function getRandomColour(){
        var red = Math.floor(Math.random()* 255);
        var green = Math.floor(Math.random() * 255);
        var blue = Math.floor(Math.random() * 255);

        return "rgb("+red+","+green+"," +blue+" )";  
    }

    function backLine() {
        this.X = Math.floor(Math.random() * race.canvas.width);
        this.Y = -1 * Math.floor(Math.random() * 300);
        this.width = Math.floor(Math.random() * 6);
        this.length = Math.floor(Math.random() * 100) + 50;
        this.speed = Math.floor(Math.random() * 6) + 5;
        this.color = getRandomColour();

        this.update = function() {
            ctx = race.context;
            ctx.beginPath();
            ctx.strokeStyle = this.color;
            ctx.moveTo(this.X, this.Y);
            ctx.lineWidth = this.width;
            ctx.lineTo(this.X, this.Y - this.length);
            ctx.closePath();
            ctx.stroke();
        }

        this.move = function() {
            if (this.Y > (race.canvas.height + this.length)) {
                this.Y = -1 * Math.floor(Math.random() * 300);
                this.X = Math.floor(Math.random() * race.canvas.width);
                this.width = Math.floor(Math.random() * 6);
                this.length = Math.floor(Math.random() * 100) + 50;
                this.speed = Math.floor(Math.random() * 6) + 5;
                this.color = getRandomColour();
            } 
            this.Y += this.speed;
        }
    }

    function turtle(x, y) {
        this.X = x;
        this.Y = y;
        this.speedX = 0;
        this.speedY = 0;
        this.frameSpeed = 15;
        this.currentFrame = 0;
        this.isJumping = false;
        this.flip = false;
        this.update = function() {
            ctx = race.context;
            //back legs
            ctx.beginPath();
            ctx.moveTo(this.X + 15, this.Y + 45);
            ctx.bezierCurveTo(this.X + 15, this.Y + 40, this.X, this.Y +30, this.X, this.Y + 50);
            ctx.closePath();
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.stroke();
            

            ctx.beginPath();
            ctx.moveTo(this.X + 45, this.Y + 60);
            ctx.bezierCurveTo(this.X + 5, this.Y + 75,this. X + 5, this.Y + 90, this.X + 15, this.Y + 90);
            ctx.closePath();
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.stroke();

            //back shell
            ctx.beginPath();
            ctx.moveTo(this.X + 30, this.Y + 30);
            ctx.bezierCurveTo(this.X + 65,this.Y + 30,this.X + 65,this.Y + 70,this.X + 50, this.Y + 70);
            ctx.bezierCurveTo(this.X + 55, this.Y +70,this.X + 55,this.Y + 30,this.X + 30,this.Y + 30);
            ctx.closePath();

            ctx.fillStyle="brown";
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(this.X +30,this.Y + 30);
            ctx.bezierCurveTo(this.X + 55,this.Y + 30,this.X + 55,this.Y + 70,this.X + 50,this.Y + 70);
            ctx.bezierCurveTo(this.X + 50, this.Y + 80,this.X + 15, this.Y + 80,this.X +15,this.Y +70);
            ctx.bezierCurveTo(this.X + 10,this.Y + 70,this.X + 10,this.Y + 35,this.X + 15,this.Y + 35);
            ctx.bezierCurveTo(this.X + 15,this.Y + 30,this.X + 35, this.Y + 30, this.X + 35, this.Y + 35);
            ctx.closePath();

            ctx.fillStyle="#f0e5c7";
            ctx.fill();
            ctx.stroke();

            //front legs
            ctx.beginPath();
            ctx.moveTo(this.X + 25, this.Y + 40);
            ctx.bezierCurveTo(this.X + 25, this.Y + 50, this.X + 45, this.Y + 50, this.X + 45, this.Y + 40);
            ctx.closePath();
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(this.X + 45,this.Y + 70);
            ctx.bezierCurveTo(this.X + 35, this.Y + 80, this.X + 50, this.Y + 90, this.X + 55, this.Y + 80);
            ctx.closePath();
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.stroke();

            //head
            ctx.beginPath();
            ctx.moveTo(this.X + 20, this.Y + 10);
            ctx.lineTo(this.X + 20, this.Y + 30);
            ctx.bezierCurveTo(this.X + 20, this.Y + 35, this.X + 30, this.Y + 35, this.X + 30, this.Y + 30);
            ctx.lineTo(this.X + 30, this.Y + 25);
            ctx.bezierCurveTo(this.X + 30, this.Y + 20, this.X + 35, this.Y + 20, this.X + 35, this.Y + 20);
            ctx.bezierCurveTo(this.X + 50, this.Y + 20, this.X + 50, this.Y, this.X + 35, this.Y);
            ctx.bezierCurveTo(this.X + 20, this.Y, this.X + 20, this.Y + 10, this.X + 20, this.Y + 10);
            ctx.closePath();

            ctx.fillStyle="green";
            ctx.fill();
            ctx.stroke();

            //eyes
            ctx.beginPath();
            ctx.rect(this.X + 30, this.Y + 5, 2, 5);
            ctx.closePath();
            ctx.fillStyle="black";
            ctx.fill();

            ctx.beginPath();
            ctx.rect(this.X + 40, this.Y + 5, 2, 5);
            ctx.closePath();
            ctx.fillStyle="black";
            ctx.fill();
        }
        this.move = function() {
            this.X += this.speedX;
            this.Y += this.speedY;
        }

    }

    function twitter(x, y) {
        this.X = x;
        this.Y = y;
        this.speed = 1;
        this.update = function() {
            ctx = race.context;
            ctx.beginPath();
            ctx.rect(this.X, this.Y, this.width, this.height);
            ctx.closePath();
            ctx.fillStyle="blue";
            ctx.fill();
        }

        this.move = function() {
            //fall and swoop to opposite side
            this.X -= this.speed;
        }
    }

</script>
</body>
</html>